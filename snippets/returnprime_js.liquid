{% if request.path contains 'return_prime' %}
<style>
  .rp_error_block {
    max-width: 700px;
    margin: 24px auto;
    background: #f9f7f2;
    padding: 28px;
    border-radius: 10px;
  }
  .rp_error_block p {
    margin: 0;
    font-size: 23px;
    text-align: center;
  }
  .not__delivered {
    background: #d7122b;
    padding: 4px 10px;
    border-radius: 8px;
    color: #fff;
    position: absolute;
    top: 0;
    left: 0;
  }
  .returnprime__refund__breakup {
  display: none !important;
}
</style>
<script>
  function showErrorMessage() {
    var returnprimeDiv = document.querySelector(".returnprime__app");        
    let divWrapper = document.createElement('div');
    divWrapper.classList.add("rp_error_block");
    let nonEligibleheading = document.createElement('p');
    nonEligibleheading.append('The order is not delivered yet, Please try again after 6-7 hours once the item is delivered. In case you face any issue even after it is delivered, please reach out to our support team over WhatsApp. Our WhatsApp support number is - 9251998279 ');
    divWrapper.appendChild(nonEligibleheading);
    if(document.getElementsByClassName('rp_error_block').length === 0) {
      returnprimeDiv.appendChild(divWrapper);
    }
  
    setTimeout(() => {
      const orderListElement = document.querySelector('.order_list');
      if (orderListElement) {
        orderListElement.remove();
      }
      const sidenavElement = document.querySelector('.returnprime__app .customer .sidenav');
      if (sidenavElement) {
        sidenavElement.remove();
      }
    }, 5);
  }

  function checkForDeliveryStatus(obj) {
    const delivered_fullfilled_items = obj.order[0].fulfillments.filter(el => el.shipment_status === "delivered");
    let delivered_line_items = [];
    if (delivered_fullfilled_items && delivered_fullfilled_items.length > 0) {
      delivered_line_items = delivered_fullfilled_items.flatMap(el => el.line_items);
    } else {
      return showErrorMessage();
    }
    
    const items__card = document.querySelectorAll('.returnprime__app .fullfiled_orders .order__card');
    items__card.forEach((item) => {
      let data_item_id = item.getAttribute('data-item-id');
      const targetFulfillment = delivered_line_items.find(each => each.id == data_item_id);
      if (!targetFulfillment || targetFulfillment.id != data_item_id) {
        item.style.opacity = '0.6';
        item.style.pointerEvents = 'none';
        item.style.cursor = 'none';
        item.style.position = 'relative';
        const paragraphElement = document.createElement('p');
        paragraphElement.textContent = 'Not delivered';
        paragraphElement.classList.add('not__delivered');
        item.appendChild(paragraphElement);
      }
    });
  }

  if (window.location.pathname.includes('return_prime')) {
      let detailsData = null;

    document.addEventListener("returnprime_orderlist_page", (e) => { 
      detailsData = e.detail;
      checkForDeliveryStatus(e.detail);
    });
     document.addEventListener('click', (e) => {
      if (e.target.closest('.fullfiled_orders .title__wrapper')) {
        checkForDeliveryStatus(detailsData);
      }
    });
  }
</script>




<!-- Return & Exchange Floating Widget Start -->
<style>
#re-widget-btn {
  position: fixed;
  bottom: 80px;
  right: 30px;
  z-index: 997;
  background: #ffee03;
  color: #000;
  border: none;
  border-radius: 19px;
  padding: 9px 21px;
  font-size: 16px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.18);
  cursor: pointer;
  transition: background 0.2s;
}
#re-widget-btn:hover {
  background: #353535;
  color: #fff;
}
#re-widget-modal-bg {
  display: none;
  position: fixed;
  z-index: 10000;
  left: 0;
  top: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(60,60,60,0.33);
}
#re-widget-modal {
  position: fixed;
  bottom: 120px;
  right: 40px;
  width: 380px;
  max-width: 95vw;
  max-height: 75vh;
  background: #fff;
  color: #222;
  border-radius: 16px;
  box-shadow: 0 4px 32px rgba(0,0,0,0.18);
  z-index: 10001;
  padding: 22px 18px 18px 18px;
  overflow-y: auto;
  display: none;
  text-align: left;
  font-size: 15px;                /* Reduced font size for desktop */
  line-height: 1.7;               /* More comfortable line height */
  letter-spacing: 0.01em;
}
#re-widget-modal h2, #re-widget-modal h3, #re-widget-modal p, #re-widget-modal ul, #re-widget-modal li {
  text-align: left !important;
  line-height: 1.7 !important;    /* Ensures consistent line height for all blocks */
}
#re-widget-modal h2 {
  font-size: 1.13em;
  margin-top: 0;
  margin-bottom: 12px;
  font-weight: 700;
}
#re-widget-modal h3 {
  margin-top: 1.1em;
  margin-bottom: 0.7em;
  font-size: 1.04em;
  font-weight: 600;
}
#re-widget-modal-close {
  position: absolute;
  top: 12px;
  right: 20px;
  font-size: 22px;
  color: #999;
  cursor: pointer;
  font-weight: bold;
  background: none;
  border: none;
}
#re-widget-modal-close:hover {
  color: #262626;
}
/* MOBILE: Centered modal, less height, smaller font, always scrollable */
@media (max-width: 600px) {
  #re-widget-modal {
    top: 50%;
    left: 50%;
    right: auto;
    bottom: auto;
    transform: translate(-50%, -50%);
    width: 94vw !important;
    height: 66vh !important;
    max-height: 66vh !important;
    min-height: 220px;
    padding: 8px 4px 14px 8px !important;
    font-size: 0.96em !important;
    border-radius: 10px !important;
    box-sizing: border-box;
    overflow-y: auto !important;
    overflow-x: hidden !important;
    line-height: 1.68 !important;
  }
  #re-widget-modal h2 {
    font-size: 1em;
    margin-bottom: 8px;
  }
  #re-widget-modal h3 {
    font-size: 0.98em;
  }
}
</style>

<button id="re-widget-btn">Policy →</button>
<div id="re-widget-modal-bg"></div>
<div id="re-widget-modal">
  <button id="re-widget-modal-close" aria-label="Close">&times;</button>
  <h2>Return , Exchange & Cancellation Policy</h2>
  <div>
    <p>We want you to love what you ordered, but if something is not right, we're here to make the return/exchange process as smooth as possible for you.</p>
    <p><b>Here's our return and exchange policy for items purchased from सादा / SAADAA :</b></p>
    <ul>
      <li>
        <b>Free One Time Returns/Exchanges:</b> You can return or exchange items of your original order for free within 7 days from the date of delivery if they are in unused condition, with original tags, and the packaging bag intact. Items received in exchange order, can not be returned or even exchanged so choose exchange items (colour, size and product) carefully while raising exchange request initially.
      </li>
      <li>
        <b>Post 7 Days:</b> After 7 days, we regret that we won't be able to facilitate exchanges or returns for any reason. Your understanding in this matter is greatly appreciated.
      </li>
      <li>
        <b>Received a Damaged or Incorrect Product:</b> In the rare event that a product you've ordered arrives in poor condition, is damaged, defective, or differs from what you ordered, you can initiate an exchange request directly on our website. Please make sure you highlight such cases within 7 days from the date of delivery. Any issue highlighted after 7 days will not be entertained.
      </li>
    </ul>
    <p style="margin-top:0.8em;"><b>NOTE – If return pickup is not possible at your Pin-Code by any of our courier partners, you will need to self-ship the product to our warehouse. We will reimburse up to ₹200 for shipping charges (based on your shipping receipt) once the process is completed. To get reimbursement, sharing the shipment receipt/bill is mandatory.</b></p>
    <h3>Returning one item purchased during a combo or exchanging with a lower value item:</h3>
    <ul>
      <li>
        If you have purchased two or multiple items from a combo and choose to return either one of them, the return amount credited would be as per the individual item price and not the combo price. Eg. If you purchase 2 Everyday Cotton Pants for Rs.1358.3 with a discount of 15% while one of them is priced at Rs.799 and choose to return one of them – then you will be refunded Rs.559.3 (1358.3 - 799). Similar Terms & Conditions apply to other product categories as well.
      </li>
      <li>
        When you send back items from an order with multiple items, the discount will be adjusted on the basis of the items you keep from the order. Eg. if you purchase 4 items and avail a discount of 25%, in case you wish to return 2 items out of them, the discount calculation will be revised to the number of products you keep, i.e. 15% for 2 items.
      </li>
    </ul>
    <h3>Exchanging product(s) with some other product(s)?</h3>
    <ul>
      <li>
        In the event of an exchange, you have the flexibility to select an alternative product of equal or lower value. If the replacement item has a lower value, you may please reach out to our customer support team once the exchange order is delivered to you, the difference will be refunded to your shared bank account or UPI ID. If you have any questions or need assistance, please feel free to contact our support team. We're here to help.
      </li>
      <li>
        <b>NOTE – Any prepaid or UPI discount (offered by Payment Gateway) applied on your original order, will not be considered in the new order value and will be removed while returning any/some items from order with multiple items, or while exchanging with any item of lower value.</b>
      </li>
    </ul>
    <h2>Cancellation Policy</h2>
    <ul>
      <li>
        We offer you the flexibility to cancel an order until the order is shipped. If you are cancelling the order due to any uncertainty, it is better to connect with our Customer Support team before cancelling. Also, some of the orders ship almost immediately and it is not always possible to cancel an order.
      </li>
    </ul>
    <h2>Refund Policy</h2>
    <ul>
      <li>
        <b>For Orders cancelled before getting shipped:</b> If you cancelled the order from our website before it getting shipped, the refund is initiated right away and it may take up to 3 to 5 business days for it to reflect in the original source of payment. You will receive SMS updates on your number if you are not enrolled in DND (Do Not Disturb).
      </li>
      <li>
        <b>For Returned Item(s):</b> Once the returned item(s) is received and inspected at our warehouse, we initiate the refund within next 1-2 business days, towards the bank account details or UPI ID entered while raising return request(s). These refunds cannot be processed towards the original source of payment.
      </li>
      <li>
        <b>For Exchange with lower value item(s):</b> You may please reach out to our customer support team once the exchange order is delivered to you, the difference will be refunded to your shared bank account or UPI ID.
      </li>
    </ul>
    <h2>Important Notice</h2>
    <ul>
      <li>
        In case of any confusion, we request you to please connect with us and we would love to clear it for you. You are solely responsible for any decision made by you without prior communication or based on assumptions.
      </li>
      <li>
        During pickup of any item(s) requested for return or exchange, it is customer's responsibility to handover only the requested item(s) as no quality check is performed at the time of pickup. Saadaa will not be responsible for any incorrect/wrong/other item(s) handed over in the pickup.
      </li>
      <li>
        Please make sure to collect the physical pickup receipt at the time of pickup as it serves as the proof of pickup. Saadaa will not be responsible for any pickup done without it being updated on the tracking as “Picked Up” if the proof of pickup is not available.
      </li>
    </ul>
    <p>Thank you for choosing <strong>सादा / SAADAA</strong></p>
  </div>
</div>
<script>
document.getElementById('re-widget-btn').onclick = function() {
  document.getElementById('re-widget-modal-bg').style.display = 'block';
  document.getElementById('re-widget-modal').style.display = 'block';
  document.body.style.overflow = 'hidden';
};
document.getElementById('re-widget-modal-close').onclick = function() {
  document.getElementById('re-widget-modal-bg').style.display = 'none';
  document.getElementById('re-widget-modal').style.display = 'none';
  document.body.style.overflow = '';
};
document.getElementById('re-widget-modal-bg').onclick = function() {
  document.getElementById('re-widget-modal-bg').style.display = 'none';
  document.getElementById('re-widget-modal').style.display = 'none';
  document.body.style.overflow = '';
};
</script>
<!-- Return & Exchange Floating Widget End -->


{% endif %}
