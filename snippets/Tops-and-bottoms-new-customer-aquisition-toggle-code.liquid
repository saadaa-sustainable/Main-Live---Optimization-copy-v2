<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Tops & Bottoms Toggle - Dynamic Banners & Cards</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    .toggle-row { display: flex; justify-content: center; gap: 1rem; }
    .toggle-btn {
      background: #f6f3f1; color: #222; border: none; outline: none; border-radius: 8px;
      font-size: 11px; font-weight: 500; padding: 2px 13px; cursor: pointer;
      transition: background-color 0.22s cubic-bezier(.44,1.34,.38,1.11),
        color 0.22s cubic-bezier(.44,1.34,.38,1.11),
        transform 0.23s cubic-bezier(.44,1.34,.38,1.11),
        box-shadow 0.22s cubic-bezier(.44,1.34,.38,1.11);
      will-change: transform, box-shadow, background, color;
      white-space: nowrap; position: relative; z-index: 1;
    }
    .toggle-btn.active { background: #fff; color: #c36a4e; transform: scale(1.10); box-shadow: 0 1px 4px 0 rgba(195,106,78,0.13);}
    .toggle-section { display: none; }
    .toggle-section.active { display: block; }
    .banner-row { margin-bottom: 0.5rem; margin-top: 0.5rem; }
    .desktop-banner { display: block; width: 100%; }
    .mobile-banner { display: none; width: 100%; }
    @media (max-width: 767px) {
      .desktop-banner { display: none; }
      .mobile-banner { display: block; }
    }
    .pc-carousel-section { padding: 0 0 2rem 0; }
    .pc-carousel-outer { position: relative; overflow: hidden; }
    .pc-carousel { display: flex; gap:5px; transform: translateX(0); transition: transform 0.3s ease;margin-left: 10px; }
    .pc-carousel-arrow {
      position: absolute; top: 50%; transform: translateY(-50%);
      z-index: 5; width: 50px; height: 50px; border: none; background: white;
      border-radius: 50%; box-shadow: 0 2px 8px rgba(0,0,0,0.1); cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      font-size: 1.2rem; color: #333; opacity: 0; pointer-events: none; transition: opacity 0.2s ease;
    }
    .pc-carousel-arrow:hover { background: #f0f0f0; color: #000; }
    .pc-arrow-left { left: 8px; }
    .pc-arrow-right { right: 8px; }
    @media (min-width: 701px) {
      .pc-carousel-outer:hover .pc-carousel-arrow { opacity: 1; pointer-events: auto; }
      .toggle-btn {
        font-size:16px;
      }
    }
    @media (max-width: 700px) {
      .pc-carousel-arrow { opacity: 0 !important; pointer-events: none !important; }
      .pc-carousel-section { padding: 0 0 0rem 0; }
    }
    .pc-carousel-slide {
      border-radius: 12px;
      min-width: 106px; flex: 0 0 260px; display: flex; flex-direction: column;
      cursor: pointer; overflow: hidden; transition: box-shadow 0.2s;
    }
    .pc-carousel-slide:hover { box-shadow: 0 6px 18px rgba(0,0,0,0.16); }
    @media (max-width: 900px) { .pc-carousel-slide { flex: 0 0 45vw; } }
    @media (max-width: 600px) { .pc-carousel-slide { flex: 0 0 56vw; } }
    .pc-product-image-wrapper { width: 100%; overflow: hidden; height: auto; }
    .pc-product-image-wrapper img { display: block; width: 100%; height: auto; }
    a.pc-carousel-link { text-decoration: none; color: inherit; display: block; }
    @media (min-width: 701px) {
      .pc-carousel-slide { min-width: 245px; }
    }
    #sticky-toggle-row {
      position: sticky; top: 81px; z-index: 950; background: #f6f3f1;
      padding-top: 10px; padding-bottom: 10px; transition: box-shadow 0.15s;
    }
    .carousel-loading {
      display:flex;align-items:center;justify-content:center;font-size:14px;color:#ba8367;
      padding:2.7em 0; font-weight: 500;
    }
    .pc-carousel-empty { padding:2em;text-align:center;color:#b08065;font-size:13px; }
  </style>
</head>
<body>
  <!-- Toggle Buttons -->
  <div class="toggle-row"  id="sticky-toggle-row">
    <button class="toggle-btn active" id="toggle-tops">Tops</button>
    <button class="toggle-btn" id="toggle-bottoms">Bottoms</button>
  </div>

  <!-- TOPS SECTION -->
  <div class="toggle-section active" id="section-tops">
    <!-- Banner 1 + cards -->
    <div class="banner-row">
      <a href="#">
        <img src="https://cdn.shopify.com/s/files/1/0450/3476/6485/files/special-coupon-corner-banner-new.webp?v=1754469496" class="desktop-banner"/>
        <img src="https://cdn.shopify.com/s/files/1/0450/3476/6485/files/special-coupon-corner-banner-new.webp?v=1754469496" class="mobile-banner"/></a>
    </div>
    <div class="pc-carousel-section">
      <div class="pc-carousel-outer" data-banner="tops-1">
        <button class="pc-carousel-arrow pc-arrow-left"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M15 6l-6 6 6 6" stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
        <div class="pc-carousel"><div class="carousel-loading">Loading…</div></div>
        <button class="pc-carousel-arrow pc-arrow-right"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M9 6l6 6-6 6" stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
      </div>
    </div>
    <!-- Banner 2 + cards -->
    <div class="banner-row">
      <a href="#">
        <img src="https://cdn.shopify.com/s/files/1/0450/3476/6485/files/special-coupon-corner-banner-new.webp?v=1754469496" class="desktop-banner"/>
        <img src="https://cdn.shopify.com/s/files/1/0450/3476/6485/files/special-coupon-corner-banner-new.webp?v=1754469496" class="mobile-banner"/></a>
    </div>
    <div class="pc-carousel-section">
      <div class="pc-carousel-outer" data-banner="tops-2">
        <button class="pc-carousel-arrow pc-arrow-left"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M15 6l-6 6 6 6" stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
        <div class="pc-carousel"><div class="carousel-loading">Loading…</div></div>
        <button class="pc-carousel-arrow pc-arrow-right"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M9 6l6 6-6 6" stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
      </div>
    </div>
    <!-- Banner 3 + cards -->
    <div class="banner-row">
      <a href="#">
        <img src="https://cdn.shopify.com/s/files/1/0450/3476/6485/files/special-coupon-corner-banner-new.webp?v=1754469496" class="desktop-banner"/>
        <img src="https://cdn.shopify.com/s/files/1/0450/3476/6485/files/special-coupon-corner-banner-new.webp?v=1754469496" class="mobile-banner"/></a>
    </div>
    <div class="pc-carousel-section">
      <div class="pc-carousel-outer" data-banner="tops-3">
        <button class="pc-carousel-arrow pc-arrow-left"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M15 6l-6 6 6 6" stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
        <div class="pc-carousel"><div class="carousel-loading">Loading…</div></div>
        <button class="pc-carousel-arrow pc-arrow-right"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M9 6l6 6-6 6" stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
      </div>
    </div>
    <!-- Banner 4 + cards -->
    <div class="banner-row">
      <a href="#">
        <img src="https://cdn.shopify.com/s/files/1/0450/3476/6485/files/special-coupon-corner-banner-new.webp?v=1754469496" class="desktop-banner"/>
        <img src="https://cdn.shopify.com/s/files/1/0450/3476/6485/files/special-coupon-corner-banner-new.webp?v=1754469496" class="mobile-banner"/></a>
    </div>
    <div class="pc-carousel-section">
      <div class="pc-carousel-outer" data-banner="tops-4">
        <button class="pc-carousel-arrow pc-arrow-left"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M15 6l-6 6 6 6" stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
        <div class="pc-carousel"><div class="carousel-loading">Loading…</div></div>
        <button class="pc-carousel-arrow pc-arrow-right"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M9 6l6 6-6 6" stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
      </div>
    </div>
    <!-- Banner 5 + cards -->
    <div class="banner-row">
      <a href="#">
        <img src="https://cdn.shopify.com/s/files/1/0450/3476/6485/files/special-coupon-corner-banner-new.webp?v=1754469496" class="desktop-banner"/>
        <img src="https://cdn.shopify.com/s/files/1/0450/3476/6485/files/special-coupon-corner-banner-new.webp?v=1754469496" class="mobile-banner"/></a>
    </div>
    <div class="pc-carousel-section">
      <div class="pc-carousel-outer" data-banner="tops-5">
        <button class="pc-carousel-arrow pc-arrow-left"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M15 6l-6 6 6 6" stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
        <div class="pc-carousel"><div class="carousel-loading">Loading…</div></div>
        <button class="pc-carousel-arrow pc-arrow-right"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M9 6l6 6-6 6" stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
      </div>
    </div>
    <!-- Banner 6 + cards -->
    <div class="banner-row">
      <a href="#">
        <img src="https://cdn.shopify.com/s/files/1/0450/3476/6485/files/special-coupon-corner-banner-new.webp?v=1754469496" class="desktop-banner"/>
        <img src="https://cdn.shopify.com/s/files/1/0450/3476/6485/files/special-coupon-corner-banner-new.webp?v=1754469496" class="mobile-banner"/></a>
    </div>
    <div class="pc-carousel-section">
      <div class="pc-carousel-outer" data-banner="tops-6">
        <button class="pc-carousel-arrow pc-arrow-left"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M15 6l-6 6 6 6" stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
        <div class="pc-carousel"><div class="carousel-loading">Loading…</div></div>
        <button class="pc-carousel-arrow pc-arrow-right"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M9 6l6 6-6 6" stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
      </div>
    </div>
  </div>

  <!-- BOTTOMS SECTION -->
  <div class="toggle-section" id="section-bottoms">
    <!-- Banner 1 + cards -->
    <div class="banner-row">
      <a href="#">
        <img src="https://cdn.shopify.com/s/files/1/0450/3476/6485/files/special-coupon-corner-banner-new.webp?v=1754469496" class="desktop-banner"/>
        <img src="https://cdn.shopify.com/s/files/1/0450/3476/6485/files/special-coupon-corner-banner-new.webp?v=1754469496" class="mobile-banner"/></a>
    </div>
    <div class="pc-carousel-section">
      <div class="pc-carousel-outer" data-banner="bottoms-1">
        <button class="pc-carousel-arrow pc-arrow-left"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M15 6l-6 6 6 6" stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
        <div class="pc-carousel"><div class="carousel-loading">Loading…</div></div>
        <button class="pc-carousel-arrow pc-arrow-right"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M9 6l6 6-6 6" stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
      </div>
    </div>
    <!-- Banner 2 + cards -->
    <div class="banner-row">
      <a href="#">
        <img src="https://cdn.shopify.com/s/files/1/0450/3476/6485/files/special-coupon-corner-banner-new.webp?v=1754469496" class="desktop-banner"/>
        <img src="https://cdn.shopify.com/s/files/1/0450/3476/6485/files/special-coupon-corner-banner-new.webp?v=1754469496" class="mobile-banner"/></a>
    </div>
    <div class="pc-carousel-section">
      <div class="pc-carousel-outer" data-banner="bottoms-2">
        <button class="pc-carousel-arrow pc-arrow-left"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M15 6l-6 6 6 6" stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
        <div class="pc-carousel"><div class="carousel-loading">Loading…</div></div>
        <button class="pc-carousel-arrow pc-arrow-right"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M9 6l6 6-6 6" stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
      </div>
    </div>
    <!-- Banner 3 + cards -->
    <div class="banner-row">
      <a href="#">
        <img src="https://cdn.shopify.com/s/files/1/0450/3476/6485/files/special-coupon-corner-banner-new.webp?v=1754469496" class="desktop-banner"/>
        <img src="https://cdn.shopify.com/s/files/1/0450/3476/6485/files/special-coupon-corner-banner-new.webp?v=1754469496" class="mobile-banner"/></a>
    </div>
    <div class="pc-carousel-section">
      <div class="pc-carousel-outer" data-banner="bottoms-3">
        <button class="pc-carousel-arrow pc-arrow-left"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M15 6l-6 6 6 6" stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
        <div class="pc-carousel"><div class="carousel-loading">Loading…</div></div>
        <button class="pc-carousel-arrow pc-arrow-right"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M9 6l6 6-6 6" stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
      </div>
    </div>
    <!-- Banner 4 + cards -->
    <div class="banner-row">
      <a href="#">
        <img src="https://cdn.shopify.com/s/files/1/0450/3476/6485/files/special-coupon-corner-banner-new.webp?v=1754469496" class="desktop-banner"/>
        <img src="https://cdn.shopify.com/s/files/1/0450/3476/6485/files/special-coupon-corner-banner-new.webp?v=1754469496" class="mobile-banner"/></a>
    </div>
    <div class="pc-carousel-section">
      <div class="pc-carousel-outer" data-banner="bottoms-4">
        <button class="pc-carousel-arrow pc-arrow-left"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M15 6l-6 6 6 6" stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
        <div class="pc-carousel"><div class="carousel-loading">Loading…</div></div>
        <button class="pc-carousel-arrow pc-arrow-right"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M9 6l6 6-6 6" stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
      </div>
    </div>
    <!-- Banner 5 + cards -->
    <div class="banner-row">
      <a href="#">
        <img src="https://cdn.shopify.com/s/files/1/0450/3476/6485/files/special-coupon-corner-banner-new.webp?v=1754469496" class="desktop-banner"/>
        <img src="https://cdn.shopify.com/s/files/1/0450/3476/6485/files/special-coupon-corner-banner-new.webp?v=1754469496" class="mobile-banner"/></a>
    </div>
    <div class="pc-carousel-section">
      <div class="pc-carousel-outer" data-banner="bottoms-5">
        <button class="pc-carousel-arrow pc-arrow-left"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M15 6l-6 6 6 6" stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
        <div class="pc-carousel"><div class="carousel-loading">Loading…</div></div>
        <button class="pc-carousel-arrow pc-arrow-right"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M9 6l6 6-6 6" stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
      </div>
    </div>
    <!-- Banner 6 + cards -->
    <div class="banner-row">
      <a href="#">
        <img src="https://cdn.shopify.com/s/files/1/0450/3476/6485/files/special-coupon-corner-banner-new.webp?v=1754469496" class="desktop-banner"/>
        <img src="https://cdn.shopify.com/s/files/1/0450/3476/6485/files/special-coupon-corner-banner-new.webp?v=1754469496" class="mobile-banner"/></a>
    </div>
    <div class="pc-carousel-section">
      <div class="pc-carousel-outer" data-banner="bottoms-6">
        <button class="pc-carousel-arrow pc-arrow-left"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M15 6l-6 6 6 6" stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
        <div class="pc-carousel"><div class="carousel-loading">Loading…</div></div>
        <button class="pc-carousel-arrow pc-arrow-right"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M9 6l6 6-6 6" stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
      </div>
    </div>
    <!-- Banner 7 + cards -->
    <div class="banner-row">
      <a href="#">
        <img src="https://cdn.shopify.com/s/files/1/0450/3476/6485/files/special-coupon-corner-banner-new.webp?v=1754469496" class="desktop-banner"/>
        <img src="https://cdn.shopify.com/s/files/1/0450/3476/6485/files/special-coupon-corner-banner-new.webp?v=1754469496" class="mobile-banner"/></a>
    </div>
    <div class="pc-carousel-section">
      <div class="pc-carousel-outer" data-banner="bottoms-7">
        <button class="pc-carousel-arrow pc-arrow-left"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M15 6l-6 6 6 6" stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
        <div class="pc-carousel"><div class="carousel-loading">Loading…</div></div>
        <button class="pc-carousel-arrow pc-arrow-right"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M9 6l6 6-6 6" stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
      </div>
    </div>
  </div>

  <script>
    // Shopify API Settings (Replace these with your real values if needed)
    const SHOP_DOMAIN = "saadaa-design.myshopify.com";
    const STOREFRONT_ACCESS_TOKEN = "388bd37219d8ab7daee1c58a23c03cc8";

    // ---- MAP BANNER TO TAG HERE! ----
    // Key = data-banner (eg. "tops-1"), value = Shopify tag (eg. "SDFSK")
    const bannerTagMap = {
      // TOPS section:
      "tops-1": "SDFSK",    // <-- REPLACE WITH YOUR TAG for Tops Banner 1
      "tops-2": "SDFLK",    
      "tops-3": "SDECT",    
      "tops-4": "SDALS",    
      "tops-5": "SDRPT",    
      "tops-6": "SDRST",    
      // Add more as needed: "tops-3": "TAG3", etc.

      // BOTTOMS section:
      "bottoms-1": "SDCP", // <-- REPLACE WITH YOUR TAG for Bottoms Banner 1
      "bottoms-2": "SDPL", // <-- REPLACE WITH YOUR TAG for Bottoms Banner 2
      "bottoms-3": "SDASP", // <-- REPLACE WITH YOUR TAG for Bottoms Banner 1
      "bottoms-4": "SDTJ", // <-- REPLACE WITH YOUR TAG for Bottoms Banner 2
      "bottoms-5": "SDAWP", // <-- REPLACE WITH YOUR TAG for Bottoms Banner 1
      "bottoms-6": "SDSSP", // <-- REPLACE WITH YOUR TAG for Bottoms Banner 2
      "bottoms-7": "SDWLP", // <-- REPLACE WITH YOUR TAG for Bottoms Banner 1
      // Add more as needed: "bottoms-3": "TAG4", etc.
    };

    // ----- Fetch products by tag -----
    async function fetchProductsByTag(tag) {
      const query = `
      {
        products(first: 20, query: "tag:'${tag}'") {
          edges {
            node {
              id
              title
              handle
              publishedAt
              images(first: 1) { edges { node { url altText } } }
            }
          }
        }
      }`;
      const response = await fetch(`https://${SHOP_DOMAIN}/api/2023-10/graphql.json`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-Shopify-Storefront-Access-Token": STOREFRONT_ACCESS_TOKEN
        },
        body: JSON.stringify({ query })
      });
      const json = await response.json();
      if (!json.data || !json.data.products) return [];
      return json.data.products.edges.map(edge => edge.node).filter(prod => prod.publishedAt);
    }

    // ----- Build carousel slides HTML -----
    function buildCarouselHTML(products) {
      if (!products.length)
        return `<div class="pc-carousel-empty">No products found.</div>`;
      return products.map(prod => {
        const imgUrl = prod.images.edges[0]?.node.url || "";
        const altTxt = prod.images.edges[0]?.node.altText || prod.title;
        return `<a class="pc-carousel-link" href="/products/${prod.handle}">
          <div class="pc-carousel-slide">
            <div class="pc-product-image-wrapper"><img src="${imgUrl}" alt="${altTxt}" loading="lazy"/></div>
          </div>
        </a>`;
      }).join("");
    }

    // ----- Load products for all carousels in the visible section -----
    async function loadCarouselsFor(section) {
      section.querySelectorAll('.pc-carousel-outer').forEach(async (outer) => {
        const bannerKey = outer.getAttribute('data-banner');
        const tag = bannerTagMap[bannerKey];
        const carousel = outer.querySelector('.pc-carousel');
        carousel.innerHTML = `<div class="carousel-loading">Loading…</div>`;
        if (!tag) {
          carousel.innerHTML = `<div class="pc-carousel-empty">No tag set.</div>`;
          return;
        }
        try {
          const products = await fetchProductsByTag(tag);
          carousel.innerHTML = buildCarouselHTML(products);
          setupCarouselScrolling(outer);
        } catch (e) {
          carousel.innerHTML = `<div class="pc-carousel-empty">Error loading products.</div>`;
        }
      });
    }

    // ----- Carousel scroll/arrow logic -----
    function setupCarouselScrolling(outer) {
      const track = outer.querySelector('.pc-carousel');
      const slides = Array.from(track.children).filter(child => child.classList.contains("pc-carousel-link"));
      const btnLeft = outer.querySelector('.pc-arrow-left');
      const btnRight = outer.querySelector('.pc-arrow-right');
      let currentIndex = 0;
      let slideWidth = 0;
      let gap = 12;
      let perView = 1;

      function calculateDimensions() {
        if (!slides.length) return;
        slideWidth = slides[0].getBoundingClientRect().width;
        perView = Math.floor(outer.clientWidth / (slideWidth + gap)) || 1;
      }
      function updateArrowsAndTransform() {
        const rawOffset = currentIndex * (slideWidth + gap);
        const maxOffset = Math.max(track.scrollWidth - outer.clientWidth, 0);
        const offset = Math.min(rawOffset, maxOffset);
        track.style.transform = `translateX(-${offset}px)`;
        if (currentIndex > 0) {
          btnLeft.style.opacity = '1'; btnLeft.style.pointerEvents = 'auto';
        } else {
          btnLeft.style.opacity = '0'; btnLeft.style.pointerEvents = 'none';
        }
        if (offset < maxOffset) {
          btnRight.style.opacity = '1'; btnRight.style.pointerEvents = 'auto';
        } else {
          btnRight.style.opacity = '0'; btnRight.style.pointerEvents = 'none';
        }
      }
      btnRight && btnRight.addEventListener('click', () => {
        currentIndex = Math.min(currentIndex + perView, slides.length - perView);
        updateArrowsAndTransform();
      });
      btnLeft && btnLeft.addEventListener('click', () => {
        currentIndex = Math.max(currentIndex - perView, 0);
        updateArrowsAndTransform();
      });
      window.addEventListener('resize', () => {
        calculateDimensions();
        if (currentIndex > slides.length - perView) {
          currentIndex = Math.max(slides.length - perView, 0);
        }
        updateArrowsAndTransform();
      });
      // Touch/swipe support
      let startX = 0;
      track.addEventListener('touchstart', e => { startX = e.touches[0].clientX; });
      track.addEventListener('touchend', e => {
        if (!startX) return;
        const diff = e.changedTouches[0].clientX - startX;
        if (diff > 50 && currentIndex > 0) { currentIndex--; }
        else if (diff < -50 && currentIndex < slides.length - perView) { currentIndex++; }
        updateArrowsAndTransform(); startX = 0;
      });
      // Initial setup
      calculateDimensions(); updateArrowsAndTransform();
    }

    // ---- Toggle logic for Tops/Bottoms -----
    const btnTops = document.getElementById("toggle-tops");
    const btnBottoms = document.getElementById("toggle-bottoms");
    const sectionTops = document.getElementById("section-tops");
    const sectionBottoms = document.getElementById("section-bottoms");
    btnTops.onclick = function() {
      btnTops.classList.add("active");
      btnBottoms.classList.remove("active");
      sectionTops.classList.add("active");
      sectionBottoms.classList.remove("active");
      loadCarouselsFor(sectionTops);
    };
    btnBottoms.onclick = function() {
      btnBottoms.classList.add("active");
      btnTops.classList.remove("active");
      sectionBottoms.classList.add("active");
      sectionTops.classList.remove("active");
      loadCarouselsFor(sectionBottoms);
    };

    // ---- Initial load -----
    document.addEventListener("DOMContentLoaded", () => {
      loadCarouselsFor(sectionTops); // show Tops section by default
    });
  </script>
</body>
</html>
