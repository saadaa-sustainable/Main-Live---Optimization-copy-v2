<script>

{% comment %} console.log('-----devworkign-------') {% endcomment %}

// Inline all utilities and configs for self-contained vanilla JS

// From utilities_newVersion.js
const waitForElements = (selector, parent = document, timeout = 10000) => new Promise((resolve, reject) => {
    const existingElements = parent.querySelectorAll(selector);
    if (existingElements.length > 0) {
        resolve([...existingElements]);
        return;
    }

    let timeoutId;

    const observer = new MutationObserver((mutationsList, observer) => {
        const targetElements = parent.querySelectorAll(selector);
        if (targetElements.length > 0) {
            clearTimeout(timeoutId);
            resolve([...targetElements]);
            observer.disconnect();
        }
    });

    const config = { childList: true, subtree: true };

    observer.observe(parent, config);

    timeoutId = setTimeout(() => {
        observer.disconnect();
        reject(new Error('Timeout: Elements not found.'));
    }, timeout);
});

const defineOptiReady = () => {
    const listeners = [];
    const doc = window.document;
    const MutationObserver = window.MutationObserver || window.WebKitMutationObserver;
    let observer;

    function ready(selector, fn) {
        listeners.push({
            selector,
            fn
        });
        if (!observer) {
            observer = new MutationObserver(check);
            observer.observe(doc.documentElement, {
                childList: true,
                subtree: true
            });
        }
        check();
    }

    function check() {
        for (let i = 0, len = listeners.length, listener, elements; i < len; i++) {
            listener = listeners[i];
            elements = doc.querySelectorAll(listener.selector);
            for (let j = 0, jLen = elements.length, element; j < jLen; j++) {
                element = elements[j];
                if (!element.ready) {
                    element.ready = [];
                }
                if (!element.ready[i]) {
                    element.ready[i] = true;
                    listener.fn.call(element, element);
                }
            }
        }
    }

    window.optiReady = ready;
};

// From url-observer.util.js
const UrlObserver = (fn) => {
    let lastUrl = window.location.href;
    new MutationObserver(() => {
        const url = window.location.href;
        if (url !== lastUrl) {
            lastUrl = url;
            setTimeout(() => {
                fn();
            }, 1000);
        }
    }).observe(document, {
        subtree: true,
        childList: true
    });
};

// From observe-layout-change.util.js
const observeLayoutChange = (fn) => {
    waitForElements('product-list [collection-mobile-layout]').then((mobileLayoutElem) => {
        if (mobileLayoutElem) {
            const config = { attributes: true, attributeFilter: ['collection-mobile-layout'] };

            const callback = (mutationsList) => {
                for (const mutation of mutationsList) {
                    if (mutation.type === 'attributes') {
                        fn();
                    }
                }
            };

            const observer = new MutationObserver(callback);
            observer.observe(mobileLayoutElem, config);
        } else {
            console.log('Element with [collection-mobile-layout] not found yet.');
        }
    });
};



// Inject CSS on load
const style = document.createElement('style');
style.textContent = sdConfig.css;
document.head.appendChild(style);


{% comment %} new code below added by saadaa dev {% endcomment %}


// ✅ Force `.sd38_originalPrice` to be red everywhere it appears
const sd38Style = document.createElement('style');
sd38Style.textContent = `
  .sd38_originalPrice,
  .sd38_originalPrice *,
  .sd38_originalPrice span,
  .sd38_originalPrice i {
    color: red !important;
  }
`;
document.head.appendChild(sd38Style);

{% comment %} // Main code (extracted and inlined)
const productsData = [
    { category: 'Airy Linen Flared Dress', color: 'Maroon', gender: 'Women' },
    { category: 'Airy Linen Flared Dress', color: 'White', gender: 'Women' },
    { category: 'Airy Linen Flared Dress', color: 'Yellow', gender: 'Women' },
    { category: 'Airy Linen Flared Dress', color: 'English Blue', gender: 'Women' },
    { category: 'Airy Linen Flared Dress', color: 'Ecru', gender: 'Women' },
    { category: 'Airy Linen Flared Dress', color: 'Black', gender: 'Women' },
    { category: 'Straight Fit Formal Pants', color: 'White', gender: 'Women' },
    { category: 'Straight Fit Formal Pants', color: 'Olive green', gender: 'Women' },
    { category: 'Straight Fit Formal Pants', color: 'Navy Blue', gender: 'Women' },
    { category: 'Straight Fit Formal Pants', color: 'German Grey', gender: 'Women' },
    { category: 'Straight Fit Formal Pants', color: 'Black', gender: 'Women' },
    { category: 'Cotton Pant', color: 'Beige', gender: 'Men' },
    { category: 'Cotton Pant', color: 'White', gender: 'Men' },
    { category: 'Cotton Pant', color: 'Navy Blue', gender: 'Men' },
    { category: 'Cotton Pant', color: 'Grey', gender: 'Men' },
    { category: 'Cotton Pant', color: 'Black', gender: 'Men' }
]; {% endcomment %}


const customSliderPriceUpdate = () => {
    waitUntil(() => document.querySelector('.sd_34-new-inserted-section[class*="men-block"]')).then(() => {
        window.optiReady('.sd_34-new-inserted-section[class*="men-block"] .sd_34-custom-slider .menu-item', (menuItemElems) => {
            const productNameElem = menuItemElems.querySelector('a > p');
            const productName = productNameElem.textContent.trim();
            const words = productName.split(' ');
            const firstWord = words[0];

            discountedProductData.forEach((item) => {
                const ifCategoryMatch = firstWord.toLowerCase() === item.category.toLowerCase();
                const ifProductNameMatch = productName.toLowerCase().includes(item.name.toLowerCase());
                if ((ifCategoryMatch || item.category === 'Shorts') && ifProductNameMatch && !checkIfCategoryAndColorExist(productName)) {
                    menuItemElems.classList.add('sd38_discountedPrice');
                    const priceElem = menuItemElems.querySelector('.price-amount');
                    const salePrice = parseInt(priceElem.textContent.replace(/[₹,\s]/g, '').trim(), 10);

                    if (salePrice < item.originalPrice.replace(/[₹,\s]/g, '') && !menuItemElems.querySelector('.sd38_originalPrice')) priceElem.insertAdjacentHTML('afterend', `<div class="sd38_originalPrice">MRP <span>₹${item.originalPrice}</span></div>`);
                }
            });
        });
    });
};

const homePageProductPriceUpdate = () => {
    waitForElements('#fittora-personaliser-root div > p > span', document, 60000).then(() => {
        window.optiReady('#fittora-personaliser-root div > p', (productElem) => {
            const productName = productElem.textContent.trim();
            const words = productName.split(' ');
            const firstWord = words[0];

            discountedProductData.forEach((item) => {
                const ifCategoryMatch = firstWord.toLowerCase() === item.category.toLowerCase();
                const ifProductNameMatch = productName.toLowerCase().includes(item.name.toLowerCase());
                ifCategoryMatch ? productElem.closest('div').classList.add('sd38_productItem') : '';
                const priceElem = productElem.nextElementSibling && productElem.nextElementSibling.querySelector('span');
                const productItem = productElem.closest('.sd38_productItem');
                if (!checkIfCategoryAndColorExist(productName) && ifCategoryMatch && ifProductNameMatch && productItem && !productItem.querySelector('.sd38_originalPrice')) {
                    productItem.classList.add('sd38_discountedPrice');
                    priceElem.insertAdjacentHTML('afterend', `<span class="sd38_originalPrice">MRP <i>₹${item.originalPrice}</i></span>`);
                }
            });
        });
    });
};

const updateDiscountedPriceHomepage = (bodyElem) => {
    if (!window.optiReady) defineOptiReady();
    bodyElem.classList.add('sd38_homepage');
    homePageProductPriceUpdate();
    UrlObserver(homePageProductPriceUpdate);
    observeLayoutChange(homePageProductPriceUpdate);
    customSliderPriceUpdate();
};

// Auto-run on homepage load (vanilla JS script execution)
if (window.location.pathname === '/') {
    updateDiscountedPriceHomepage(document.body);
}

    
</script>