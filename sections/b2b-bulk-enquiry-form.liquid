{% schema %}
  {
    "name": "b2b-bulk-enquiry-form",
    "class": "section-upf",
    "settings": [
      {
        "type": "checkbox",
        "id": "separate_section_with_border",
        "label": "Separate section with border",
        "default": true
      },
      {
        "type": "checkbox",
        "id": "remove_upper_vertical_spacing",
        "label": "Remove upper vertical spacing",
        "default": false
      },
      {
        "type": "checkbox",
        "id": "remove_lower_vertical_spacing",
        "label": "Remove lower vertical spacing",
        "default": false
      }
    ],
    "presets": [
      {"name":"b2b-bulk-enquiry-form"}
    ]
  }
{% endschema %}

<style>
.bulk-b2b-onboarding input,
.bulk-b2b-onboarding select {
  border-bottom: .5px solid #333;
  outline: none;
  height: 24px;
  font-size: 12px;
  font-weight: 300;
  background: white;
}
.bulk-b2b-onboarding .bulk-b2b-container .h6 {
  color: #8D8D8D;
  font-weight: 300;
}
.bulk-b2b-onboarding .bulk-b2b-container .h2 {
  font-weight: 500;
}
.bulk-b2b-onboarding label {
  font-size: 11px;
  color: black;
}
.bulk-b2b-onboarding .bulk-b2b-container {
  background: white;

  border-radius: 12px;
 
  margin-top: 18px;
}
.section-upf {
  position: relative;
  z-index: 2;
  margin-top: -32px;
}
.bulk-b2b-onboarding .button {
  margin-top: 18px;
  margin-inline: 24px;
  font-size: 15px;
  font-weight: 500;
}
.gap-10 { gap: 1.5rem; }
.v-stack { display: flex; flex-direction: column; }
.gap-2 { gap: .5rem; }
.gap-4 { gap: 1rem; }
.section-heading {
  font-size: 16px;
  font-weight: 600;
  margin-bottom: 6px;
  margin-top: 14px;
  color: #3b3b3b;
}
.helper {
  font-size: 11px;
  color: #888;
  margin-bottom: 4px;
  margin-top: 1px;
}
@media (min-width: 768px) {
  .bulk-b2b-onboarding .bulk-b2b-container { padding: 38px 34px; }
  .bulk-b2b-onboarding input,
  .bulk-b2b-onboarding select { font-size: 15px; height: 32px; }
  .bulk-b2b-onboarding label { font-size: 13px; }
  .bulk-b2b-onboarding .bulk-b2b-container .h2 { font-size: 2rem; }
  .bulk-b2b-onboarding .bulk-b2b-container .h6 { font-size: 1.2rem; }
  .section-heading { font-size: 19px; }
}
.text-center { text-align: left; }
.row-flex {
  display: flex;
  gap: 1rem;
  margin-bottom: 1.2rem;
}
.row-flex > .v-stack {
  flex: 1 1 0;
  min-width: 0;
}
.bulk-b2b-onboarding input::placeholder {
  font-size: 11px;
  color: #aaa;
}
#b2b-message {
  display: none;
  margin: 10px 0 0 0;
  padding: 10px 8px;
  border-radius: 5px;
  font-size: 13px;
  font-weight: 500;
  text-align: center;
}
#b2b-message.success {
  background: #e6ffed;
  color: #155724;
  border: 1px solid #a6e7c3;
}
#b2b-message.error {
  background: #fff0f0;
  color: #c80f2e;
  border: 1px solid #f7cac9;
}

#b2b-message.submitting {
  background: #f3f8ff;
  color: #1863b8;
  border: 1px solid #b4d8ff;
}
</style>

<div class="{% unless section.settings.remove_upper_vertical_spacing %}upper-section-spacing{% endunless %} {% unless section.settings.remove_lower_vertical_spacing %}lower-section-spacing{% endunless %}">
  <div class="container container--xs bulk-b2b-onboarding">
    <div class="bulk-b2b-container v-stack gap-10">
      <div class="text-center v-stack gap-2">
        <p class="h2">Planning to Order BIG?</p>
        <p class="h6">Please fill in your details and our team will reach out to you</p>
      </div>
      <form class="v-stack gap-5" id="bulkB2BForm" autocomplete="off">
        <div class="v-stack">
          <label for="b2b_fullName">Full Name <span style="color:red">*</span></label>
          <input type="text" id="b2b_fullName" name="fullName" placeholder="Enter your full name" required>
          <small style="color:red;font-size:10px"></small>
        </div>
        <div class="v-stack">
          <label for="b2b_brandName">Brand / Company Name <span style="color:red">*</span></label>
          <input type="text" id="b2b_brandName" name="brandName" placeholder="Enter your brand or company name" required>
          <small style="color:red;font-size:10px"></small>
        </div>
        <div class="v-stack">
          <label for="b2b_natureOfBusiness">Nature Of Your Business <span style="color:red">*</span></label>
          <select id="b2b_natureOfBusiness" name="natureOfBusiness" required>
            <option value="">Select...</option>
            <option value="LargeFormatStore">Large Format Store</option>
            <option value="Distributor">Distributor</option>
            <option value="Franchisee">Franchisee</option>
            <option value="Retailer">Retailer</option>
            <option value="Wholesale">Wholesale</option>
            <option value="Resell">Re-Sell</option>
          </select>
          <small style="color:red;font-size:10px"></small>
        </div>
        <div class="v-stack">
          <label for="b2b_cityPostal">City & Postal Code <span style="color:red">*</span></label>
          <input type="text" id="b2b_cityPostal" name="cityPostal" placeholder="e.g. Mumbai, 400001" required>
          <small style="color:red;font-size:10px"></small>
        </div>
        <div class="row-flex">
          <div class="v-stack">
            <label for="b2b_phone">Phone <span style="color:red">*</span></label>
            <input type="tel" id="b2b_phone" name="phone" placeholder="Enter your 10-digit phone no" required maxlength="10">
            <small style="color:red;font-size:10px"></small>
          </div>
          <div class="v-stack">
            <label for="b2b_email">Email <span style="color:red">*</span></label>
            <input type="email" id="b2b_email" name="email" placeholder="Enter your email address" required>
            <small style="color:red;font-size:10px"></small>
          </div>
        </div>
        <div class="v-stack">
          <label for="b2b_productQuantity">What product quantities are you looking to order? <span style="color:red">*</span></label>
          <select id="b2b_productQuantity" name="productQuantity" required>
            <option value="">Select...</option>
            <option value="0-50">0-50 pcs</option>
            <option value="51-100">51-100 pcs</option>
            <option value="101-250">101-250 pcs</option>
            <option value="250-500">250-500 pcs</option>
            <option value="500-1000">500-1000 pcs</option>
            <option value="Above1000">Above 1000 pcs</option>
          </select>
          <small style="color:red;font-size:10px"></small>
        </div>
        <button class="button" id="b2b_submit">Submit</button>
        <div id="b2b-message"></div>
      </form>
    </div>
  </div>
</div>

<script>
function isValidPhoneNumber(phone){
  return /^\d{10}$/.test(phone) && phone[0] !== "0";
}
function isValidEmail(email){
  return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
}
function isValidCityPostal(cityPostal){
  return /^[A-Za-z\s]+,\s*\d{6}$/.test(cityPostal);
}
function showErrorBelowInput(input, msg) {
  let el = input.nextElementSibling;
  while (el && el.tagName !== "SMALL") {
    el = el.nextElementSibling;
  }
  if (el) {
    el.innerHTML = msg || "Please enter a correct value!";
    input.scrollIntoView({ behavior: "smooth", block: "center" });
    input.focus();
  }
}
document.getElementById("b2b_phone").addEventListener("input", function(e) {
  this.value = this.value.replace(/\D/g, "").slice(0,10);
});
document.getElementById("bulkB2BForm").addEventListener("submit", function (e) {
  e.preventDefault();

  document.querySelectorAll("#bulkB2BForm small").forEach(e=>e.innerHTML="");
  let valid = true;
  const f = id => document.getElementById(id);

  // Validate fields
  if (!f("b2b_fullName").value.trim()) { showErrorBelowInput(f("b2b_fullName")); valid = false; }
  if (!f("b2b_brandName").value.trim()) { showErrorBelowInput(f("b2b_brandName")); valid = false; }
  if (!f("b2b_natureOfBusiness").value.trim()) { showErrorBelowInput(f("b2b_natureOfBusiness")); valid = false; }
  if (!f("b2b_cityPostal").value.trim() || !isValidCityPostal(f("b2b_cityPostal").value.trim())) {
    showErrorBelowInput(f("b2b_cityPostal"), "e.g. Mumbai, 400001");
    valid = false;
  }
  if (!f("b2b_phone").value.trim() || !isValidPhoneNumber(f("b2b_phone").value.trim())) {
    showErrorBelowInput(f("b2b_phone"), "Enter 10 digit phone (not starting with 0)");
    valid = false;
  }
  if (!f("b2b_email").value.trim() || !isValidEmail(f("b2b_email").value.trim())) {
    showErrorBelowInput(f("b2b_email"), "Enter a valid email address");
    valid = false;
  }
  if (!f("b2b_productQuantity").value.trim()) { showErrorBelowInput(f("b2b_productQuantity")); valid = false; }

  if (!valid) return;

  // Show message
  const msgDiv = document.getElementById("b2b-message");
  msgDiv.textContent = "Submitting...";
  msgDiv.className = "submitting";
  msgDiv.style.display = "block";

  // Prepare data
  const formData = new FormData(this);
  const params = new URLSearchParams();
  for (const pair of formData.entries()) {
    params.append(pair[0], pair[1]);
  }

  // Change to your script URL
  const scriptURL = "https://script.google.com/macros/s/AKfycbx1vEJRUT6lMYWrlw932tH4o9YegxkPvEgAmWP01fk76Z1Ms0FDRvoRjzVseIX80E-SLw/exec";
  fetch(scriptURL, {
    method: "POST",
    body: params,
    headers: { "Content-Type": "application/x-www-form-urlencoded" }
  })
  .then(res => res.ok ? res.text() : Promise.reject("Failed"))
  .then(() => {
    msgDiv.textContent = "Data submitted successfully!";
    msgDiv.className = "success";
    setTimeout(() => { msgDiv.textContent = ""; msgDiv.style.display = "none"; }, 1400);
    document.getElementById("bulkB2BForm").reset();
  })
  .catch(() => {
    msgDiv.textContent = "An error occurred while submitting the form.";
    msgDiv.className = "error";
  });
});
</script>
